<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Chelmsford Hockey Club Beer & Cider Festival - November 2025</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: Arial, Helvetica, sans-serif;
            background: #f5f5f5;
            color: #222;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 6px 18px rgba(0,0,0,0.06);
        }

        header { text-align: center; margin-bottom: 36px; padding-bottom: 16px; border-bottom: 2px solid #333; }
        h1 { font-size: 2rem; margin-bottom: 6px; }
        .subtitle { font-size: 1.15rem; font-weight: 700; margin-bottom: 6px; }
        .sponsor { color: #444; margin-bottom: 4px; }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 28px;
            margin-top: 18px;
        }

        .section h2 { font-size: 1.25rem; margin-bottom: 12px; padding-bottom: 6px; border-bottom: 1px solid #e6e6e6; }

        .section h3 { font-size: 1.05rem; margin-top: 18px; margin-bottom: 8px; }

        .item-header {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            padding: 10px 0;
            font-weight: 700;
            border-bottom: 2px solid #333;
            margin-bottom: 10px;
            align-items: center;
        }

        .beer-item, .cider-item {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            padding: 12px 0;
            border-bottom: 1px solid #eee;
            align-items: center;
            gap: 8px;
        }

        .beer-info { display:flex; flex-direction: column; gap: 4px; }
        .beer-name { font-weight: 700; font-size: 1rem; letter-spacing: 0.2px; }
        .brewery { color:#666; font-size:0.87rem; }
        .abv { font-weight:700; text-align: left; }

        /* Stock column (prominent bar) */
        .stock {
            display:flex;
            flex-direction: column;
            align-items: flex-end;
            gap:6px;
        }

        .stock-bar {
            width: 100%;
            height: 20px; /* prominent height */
            background: linear-gradient(180deg,#f0f0f0,#eaeaea);
            border-radius: 10px;
            overflow: hidden;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
            position: relative;
        }

        .stock-fill {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 0%;
            border-radius: 10px 0 0 10px;
            /* gradient for pleasant look */
            background: linear-gradient(90deg, #4caf50, #2e7d32);
            transition: width 500ms ease-in-out;
        }

        /* when 0% we keep the rounded corners on both sides */
        .stock-fill.zero {
            border-radius: 10px;
        }

        /* Optional small text below the bar (left blank intentionally because user requested no % displayed) */
        .stock-caption {
            font-size: 0.8rem;
            color: #666;
            height: 14px; /* keep layout consistent even if text empty */
            width: 100%;
            text-align: right;
        }

        .sponsors-section {
            padding-top: 20px;
            border-top: 2px solid #333;
            text-align: center;
            margin-top: 18px;
        }

        .sponsors-list {
            display:flex;
            justify-content:center;
            flex-wrap:wrap;
            gap:10px;
            margin-top: 8px;
        }

        .sponsor-item {
            padding:6px 12px;
            background:#f0f0f0;
            border-radius:6px;
            font-size:0.9rem;
        }

        @media (max-width: 1000px) {
            .content-grid { grid-template-columns: 1fr 1fr; }
        }

        @media (max-width: 620px) {
            .content-grid { grid-template-columns: 1fr; }
            .item-header, .beer-item, .cider-item { grid-template-columns: 1.5fr 0.8fr 1fr; gap:6px; }
            .abv { text-align: left; }
            .stock { align-items: flex-start; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Chelmsford Hockey Club</h1>
            <div class="subtitle">Beer & Cider Festival</div>
            <div class="sponsor">Proudly sponsored by Gray & Sons</div>
            <div class="sponsor">November 2025</div>
        </header>

        <div class="content-grid">
            <!-- Festival Beers Section -->
            <div class="section">
                <h2>Festival Beers</h2>

                <div class="item-header">
                    <div>Name / Brewery</div>
                    <div>ABV</div>
                    <div style="text-align: right;">Stock Level</div>
                </div>

                <div class="beer-item">
                    <div class="beer-info">
                        <div class="beer-name">LIONHEART</div>
                        <div class="brewery">Mighty Oak Brewery</div>
                    </div>
                    <div class="abv">3.6%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="beer-item">
                    <div class="beer-info">
                        <div class="beer-name">RIBBLEHEAD BITTER</div>
                        <div class="brewery">Settle Brewery</div>
                    </div>
                    <div class="abv">3.8%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="beer-item">
                    <div class="beer-info">
                        <div class="beer-name">PENNINE DARK MILD</div>
                        <div class="brewery">Tatton Brewery</div>
                    </div>
                    <div class="abv">3.9%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="beer-item">
                    <div class="beer-info">
                        <div class="beer-name">LEGACY</div>
                        <div class="brewery">Brentwood Brewery</div>
                    </div>
                    <div class="abv">4.0%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="beer-item">
                    <div class="beer-info">
                        <div class="beer-name">INFERNO</div>
                        <div class="brewery">Oakham Ales</div>
                    </div>
                    <div class="abv">4.0%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="beer-item">
                    <div class="beer-info">
                        <div class="beer-name">SWEENEY TODD</div>
                        <div class="brewery">Colchester Brewery</div>
                    </div>
                    <div class="abv">4.2%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="beer-item">
                    <div class="beer-info">
                        <div class="beer-name">SIX LITTLE SHIPS</div>
                        <div class="brewery">Leigh-on-Sea</div>
                    </div>
                    <div class="abv">4.2%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="beer-item">
                    <div class="beer-info">
                        <div class="beer-name">LUSHINGTONS</div>
                        <div class="brewery">Skinners Brewery</div>
                    </div>
                    <div class="abv">4.2%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="beer-item">
                    <div class="beer-info">
                        <div class="beer-name">HEART OF DARKNESS</div>
                        <div class="brewery">Wantsum</div>
                    </div>
                    <div class="abv">4.5%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="beer-item">
                    <div class="beer-info">
                        <div class="beer-name">GRAVITAS</div>
                        <div class="brewery">Vale Brewery</div>
                    </div>
                    <div class="abv">4.8%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <h3>Behind the Bar</h3>

                <div class="beer-item">
                    <div class="beer-info">
                        <div class="beer-name">CAPTAIN BOB</div>
                        <div class="brewery">Mighty Oak Brewery</div>
                    </div>
                    <div class="abv">3.8%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="beer-item">
                    <div class="beer-info">
                        <div class="beer-name">SILVER ADDER</div>
                        <div class="brewery">Mauldons Brewery</div>
                    </div>
                    <div class="abv">4.2%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>
            </div>

            <!-- Cider Section -->
            <div class="section">
                <h2>Cider</h2>

                <div class="item-header">
                    <div>Name / Brewery</div>
                    <div>ABV</div>
                    <div style="text-align: right;">Stock Level</div>
                </div>

                <h3>Lilley's Cider</h3>

                <div class="cider-item">
                    <div class="beer-info">
                        <div class="beer-name">FIREDANCER</div>
                    </div>
                    <div class="abv">4.5%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="cider-item">
                    <div class="beer-info">
                        <div class="beer-name">SELECT</div>
                    </div>
                    <div class="abv">4.8%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="cider-item">
                    <div class="beer-info">
                        <div class="beer-name">RED RABBIT</div>
                    </div>
                    <div class="abv">6.0%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="cider-item">
                    <div class="beer-info">
                        <div class="beer-name">BEE STING (Perry)</div>
                    </div>
                    <div class="abv">6.8%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <h3>Lilley's Flavoured Cider</h3>

                <div class="cider-item">
                    <div class="beer-info">
                        <div class="beer-name">ELDERFLOWER</div>
                    </div>
                    <div class="abv">3.4%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="cider-item">
                    <div class="beer-info">
                        <div class="beer-name">PINA COLADA</div>
                    </div>
                    <div class="abv">3.4%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="cider-item">
                    <div class="beer-info">
                        <div class="beer-name">RASPBERRY MOJITO</div>
                    </div>
                    <div class="abv">3.4%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="cider-item">
                    <div class="beer-info">
                        <div class="beer-name">WILD BERRY</div>
                    </div>
                    <div class="abv">3.4%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="cider-item">
                    <div class="beer-info">
                        <div class="beer-name">MAN-GHOOOUL (Mango)</div>
                    </div>
                    <div class="abv">4.0%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="cider-item">
                    <div class="beer-info">
                        <div class="beer-name">RHUBARB</div>
                    </div>
                    <div class="abv">4.0%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>
            </div>

            <!-- Low Alcohol Section -->
            <div class="section">
                <h2>Low Alcohol (500ml bottles)</h2>

                <div class="item-header">
                    <div>Name / Brewery</div>
                    <div>ABV</div>
                    <div style="text-align: right;">Stock Level</div>
                </div>

                <div class="beer-item">
                    <div class="beer-info">
                        <div class="beer-name">LOW TIDE</div>
                        <div class="brewery">Shipyard</div>
                    </div>
                    <div class="abv">0.5%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="beer-item">
                    <div class="beer-info">
                        <div class="beer-name">PROPER JOB</div>
                        <div class="brewery">St Austell</div>
                    </div>
                    <div class="abv">0.5%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>

                <div class="beer-item">
                    <div class="beer-info">
                        <div class="beer-name">GHOST SHIP</div>
                        <div class="brewery">Adnams (club bar)</div>
                    </div>
                    <div class="abv">0.5%</div>
                    <div class="stock">
                        <div class="stock-bar"><div class="stock-fill" aria-hidden="true"></div></div>
                        <div class="stock-caption"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sponsors Section -->
        <div class="sponsors-section">
            <h2>Thank You to Our Sponsors</h2>
            <div class="sponsors-list">
                <div class="sponsor-item">David Carr Esq.</div>
                <div class="sponsor-item">Toby "Can't concede if you don't play" Stock</div>
                <div class="sponsor-item">FITBRAIN 4 KIDS</div>
                <div class="sponsor-item">Mens Vets</div>
                <div class="sponsor-item">Mens Evergreens</div>
                <div class="sponsor-item">Mens 1XI</div>
            </div>
        </div>
    </div>

    <script>
        // JSONBin details (as provided)
        const JSONBIN_BIN_ID = "690a223c43b1c97be9987c36";
        const JSONBIN_KEY = "$2a$10$5J2bEaYJje4O1i40NLVVTu9u9Tz2kmlIl0xKoWpGr2vaIUPhp93ey";

        /**
         * Normalize a drink name from the DOM to match keys in your JSON:
         * - trim
         * - convert to upper case
         * - collapse multiple whitespace to single space
         */
        function normalizeName(text) {
            return text.replace(/\s+/g, ' ').trim().toUpperCase();
        }

        async function fetchStock() {
            const url = `https://api.jsonbin.io/v3/b/${JSONBIN_BIN_ID}/latest`;
            try {
                const res = await fetch(url, {
                    headers: { "X-Master-Key": JSONBIN_KEY }
                });

                if (!res.ok) {
                    console.error("JSONBin fetch failed:", res.status, res.statusText);
                    return null;
                }

                const json = await res.json();
                // JSONBin v3 returns the stored JSON in json.record
                return json.record || null;
            } catch (err) {
                console.error("Error fetching JSONBin data:", err);
                return null;
            }
        }

        /**
         * Update every .beer-item and .cider-item on the page with stock bar widths.
         * If the JSON contains a matching key (normalized name), apply its value (e.g. "75%").
         * Otherwise set to 0% (empty).
         */
        async function updateStockBars() {
            const stockData = await fetchStock();
            const items = Array.from(document.querySelectorAll('.beer-item, .cider-item'));

            items.forEach(item => {
                const nameEl = item.querySelector('.beer-name');
                const fillEl = item.querySelector('.stock-fill');
                const captionEl = item.querySelector('.stock-caption');

                if (!nameEl || !fillEl) return;

                const normalized = normalizeName(nameEl.textContent || '');
                let value = null;

                if (stockData && Object.prototype.hasOwnProperty.call(stockData, normalized)) {
                    value = stockData[normalized]; // e.g. "75%"
                } else if (stockData && Object.prototype.hasOwnProperty.call(stockData, nameEl.textContent.trim())) {
                    // fallback if JSON keys are exact-case
                    value = stockData[nameEl.textContent.trim()];
                }

                if (typeof value === 'string') {
                    // sanitize the value: allow "NN%" or "NN" or "NN %"
                    const matched = value.match(/(\d{1,3})/);
                    let pct = 0;
                    if (matched) {
                        pct = parseInt(matched[1], 10);
                        if (isNaN(pct)) pct = 0;
                        if (pct < 0) pct = 0;
                        if (pct > 100) pct = 100;
                    }
                    fillEl.style.width = pct + '%';
                    fillEl.classList.toggle('zero', pct === 0);
                    // Accessibility: store aria-valuenow (but not visible)
                    fillEl.setAttribute('role', 'progressbar');
                    fillEl.setAttribute('aria-valuemin', '0');
                    fillEl.setAttribute('aria-valuemax', '100');
                    fillEl.setAttribute('aria-valuenow', String(pct));

                    // user requested no visible % â€” keep caption blank
                    if (captionEl) captionEl.textContent = '';
                } else {
                    // no data for this item
                    fillEl.style.width = '0%';
                    fillEl.classList.add('zero');
                    if (captionEl) captionEl.textContent = '';
                    fillEl.setAttribute('aria-valuenow', '0');
                }
            });
        }

        // Initial update
        updateStockBars();

        // Refresh regularly
        const REFRESH_MS = 60 * 1000; // 60 seconds
        setInterval(updateStockBars, REFRESH_MS);
    </script>
</body>
</html>
