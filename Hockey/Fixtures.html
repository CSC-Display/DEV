<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Fixtures</title>
  <!-- Link to Poppins font -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700&display=swap" rel="stylesheet" />
  <style>
    /* General Reset */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* Hide everything in body except .gms-wrapper */
    body > *:not(.gms-wrapper):not(.refresh-indicator) {
      display: none !important;
    }

    /* Inside .gms-wrapper hide everything except the table */
    .gms-wrapper > *:not(.gms-table-fixtures) {
      display: none !important;
    }

    /* Body Styling - Responsive */
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f4f4f4;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      padding: 10px;
      overflow-x: auto;
    }

    /* Refresh Indicator - Responsive positioning */
    .refresh-indicator {
      position: fixed;
      bottom: 10px;
      left: 10px;
      font-family: 'Poppins', sans-serif;
      font-size: clamp(12px, 2vw, 14px);
      font-weight: 400;
      color: #666;
      background-color: rgba(255, 255, 255, 0.9);
      padding: 8px 12px;
      border-radius: 4px;
      z-index: 1000;
      transition: color 0.3s ease;
      backdrop-filter: blur(5px);
    }

    .refresh-indicator.refreshing {
      color: #007bff;
    }

    /* Table Container - Fully responsive */
    .gms-wrapper {
      width: 100%;
      max-width: none;
      background-color: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      overflow: auto;
      position: relative;
      margin-bottom: 60px;
    }

    /* Loading overlay */
    .loading-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(255, 255, 255, 0.8);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 100;
      font-size: clamp(14px, 2.5vw, 16px);
    }

    .loading-overlay.active {
      display: flex;
    }

    /* Table Styling - Responsive */
    .gms-table-fixtures {
      width: 100%;
      min-width: 600px; /* Minimum width to prevent over-compression */
      border-collapse: collapse;
      text-align: left;
      font-weight: 400;
      font-size: clamp(12px, 2vw, 16px);
    }

    .gms-table-fixtures th,
    .gms-table-fixtures td {
      padding: clamp(8px, 2vw, 15px) clamp(6px, 1.5vw, 12px);
      border-bottom: 1px solid #ddd;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Remove all background colors except header */
    .gms-table-fixtures td,
    .gms-table-fixtures tr:nth-child(even),
    .gms-table-fixtures tr:hover {
      background-color: transparent !important;
    }

    /* Header row: black background, white text */
    .gms-table-fixtures th {
      background-color: black !important;
      color: white !important;
      font-weight: 700 !important;
      position: sticky;
      top: 0;
      z-index: 10;
    }

    /* Set all cell text to black and normal weight */
    .gms-table-fixtures td {
      color: black !important;
      font-weight: 400 !important;
    }

    /* Hide Date and Venue Columns */
    .gms-table-fixtures th:nth-child(1),
    .gms-table-fixtures td:nth-child(1),
    .gms-table-fixtures th:nth-child(5),
    .gms-table-fixtures td:nth-child(5) {
      display: none;
    }

    /* Mobile optimizations */
    @media screen and (max-width: 768px) {
      body {
        padding: 5px;
      }

      .gms-wrapper {
        border-radius: 4px;
        margin-bottom: 70px;
      }

      .gms-table-fixtures {
        min-width: 500px; /* Smaller minimum on mobile */
      }

      .gms-table-fixtures th,
      .gms-table-fixtures td {
        padding: 8px 6px;
      }

      .refresh-indicator {
        font-size: 12px;
        padding: 6px 10px;
        bottom: 5px;
        left: 5px;
      }
    }

    /* Extra small screens */
    @media screen and (max-width: 480px) {
      .gms-table-fixtures {
        min-width: 400px;
        font-size: 11px;
      }

      .gms-table-fixtures th,
      .gms-table-fixtures td {
        padding: 6px 4px;
      }

      /* Allow text wrapping on very small screens */
      .gms-table-fixtures th,
      .gms-table-fixtures td {
        white-space: normal;
      }
    }

    /* Large screens optimization */
    @media screen and (min-width: 1200px) {
      .gms-wrapper {
        max-width: 1200px;
      }
    }

    /* Landscape orientation on mobile */
    @media screen and (max-width: 768px) and (orientation: landscape) {
      body {
        justify-content: flex-start;
        padding-top: 5px;
      }
      
      .refresh-indicator {
        position: absolute;
        bottom: 5px;
      }
    }

    /* Print styles */
    @media print {
      .refresh-indicator,
      .loading-overlay {
        display: none !important;
      }
      
      body {
        background-color: white;
        padding: 0;
      }
      
      .gms-wrapper {
        box-shadow: none;
        border: 1px solid #ccc;
      }
    }

  </style>
</head>
<body>

  <div class="refresh-indicator" id="refreshIndicator">
    Next refresh in <span id="countdown">15:00</span>
  </div>

  <div class="gms-wrapper gms-ajax"
       id="gmsWrapper"
       data-method="api-dynamic"
       data-show="fixtures"
       data-club_id="e9ba26d3-7e18-4772-abb0-584e887c9d38"
       data-sort_by="fixtureTime"
       data-options="showGender:yes">
    <div class="loading-overlay" id="loadingOverlay">
      <div>Refreshing fixtures...</div>
    </div>
  </div>

  <script src="https://gmsfeed.co.uk/js/api.js"></script>
  
  <script>
    // Auto-refresh functionality
    let refreshInterval;
    let countdownInterval;
    let timeLeft = 15 * 60; // 15 minutes in seconds

    function updateCountdown() {
      const minutes = Math.floor(timeLeft / 60);
      const seconds = timeLeft % 60;
      const formattedTime = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      
      const countdownElement = document.getElementById('countdown');
      if (countdownElement) {
        countdownElement.textContent = formattedTime;
      }
      
      timeLeft--;
      
      if (timeLeft < 0) {
        refreshGMSData();
        timeLeft = 15 * 60; // Reset to 15 minutes
      }
    }

    function refreshGMSData() {
      const indicator = document.getElementById('refreshIndicator');
      const loadingOverlay = document.getElementById('loadingOverlay');
      const wrapper = document.getElementById('gmsWrapper');
      
      // Show refreshing state
      if (indicator) {
        indicator.classList.add('refreshing');
        indicator.innerHTML = 'Refreshing fixtures...';
      }
      
      if (loadingOverlay) {
        loadingOverlay.classList.add('active');
      }
      
      try {
        // Clear existing content except loading overlay
        const existingTable = wrapper.querySelector('.gms-table-fixtures');
        if (existingTable) {
          existingTable.remove();
        }
        
        // Re-trigger GMS API call
        if (typeof window.gmsAPI !== 'undefined' && window.gmsAPI.refresh) {
          // If GMS API has a refresh method
          window.gmsAPI.refresh(wrapper);
        } else {
          // Alternative: reload the script to trigger fresh data
          const script = document.querySelector('script[src="https://gmsfeed.co.uk/js/api.js"]');
          if (script) {
            script.remove();
            const newScript = document.createElement('script');
            newScript.src = 'https://gmsfeed.co.uk/js/api.js';
            newScript.onload = function() {
              // GMS should automatically process the wrapper after script load
              setTimeout(() => {
                if (loadingOverlay) {
                  loadingOverlay.classList.remove('active');
                }
              }, 2000);
            };
            document.body.appendChild(newScript);
          }
        }
        
        // Reset indicator after a delay
        setTimeout(() => {
          if (indicator) {
            indicator.classList.remove('refreshing');
            indicator.innerHTML = 'Next refresh in <span id="countdown">15:00</span>';
          }
          if (loadingOverlay) {
            loadingOverlay.classList.remove('active');
          }
        }, 3000);
        
      } catch (error) {
        console.error('Error refreshing GMS data:', error);
        
        // Reset indicator on error
        if (indicator) {
          indicator.classList.remove('refreshing');
          indicator.innerHTML = 'Next refresh in <span id="countdown">15:00</span>';
        }
        if (loadingOverlay) {
          loadingOverlay.classList.remove('active');
        }
      }
    }

    function startAutoRefresh() {
      // Start countdown timer (updates every second)
      countdownInterval = setInterval(updateCountdown, 1000);
      
      // Initial countdown display
      updateCountdown();
    }

    // Initialize auto-refresh when page loads
    window.addEventListener('load', function() {
      // Wait a moment for GMS to initialize, then start auto-refresh
      setTimeout(startAutoRefresh, 2000);
    });

    // Cleanup intervals when page unloads
    window.addEventListener('beforeunload', function() {
      if (refreshInterval) clearInterval(refreshInterval);
      if (countdownInterval) clearInterval(countdownInterval);
    });

    // Optional: Add manual refresh capability
    document.addEventListener('keydown', function(e) {
      // Press 'R' key to manually refresh
      if (e.key === 'r' || e.key === 'R') {
        timeLeft = 0; // Trigger immediate refresh
      }
    });

    // Handle orientation changes on mobile
    window.addEventListener('orientationchange', function() {
      // Small delay to allow for orientation change completion
      setTimeout(() => {
        // Force a repaint to ensure proper scaling
        document.body.style.height = 'auto';
        document.body.offsetHeight; // Trigger reflow
      }, 100);
    });
  </script>
  
</body>
</html>
